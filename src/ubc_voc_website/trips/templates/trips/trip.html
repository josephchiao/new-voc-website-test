{% extends "base.html" %}

{% load static %}
{% load role_tags %}

{% block title %}{{ trip.name }}{% endblock %}

{% block head_content %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Setup car checkbox
            const carCheckbox = document.querySelector('#id_can_drive');
            const carSpotsDiv = document.getElementById('car-spots-div');
            carSpotsDiv.style.display = carCheckbox.checked ? 'block' : 'none';
            carCheckbox.addEventListener('change', function () {
                carSpotsDiv.style.display = this.checked ? 'block' : 'none';
            });
        });
    </script>
{% endblock %}

{% block content %}
    <div class="container">
        <h2>{{ trip.name }}</h2>
        <h5>{{ trip.trip_date_as_str_long }}</h5>

        {% if request.user|is_member %}
            <a href="#signup-form">Jump to signup form</a>
        {% endif %}

        <p>
            <b>Organized by:</b> 
            {% for organizer in organizers %}
                <a href="{% url 'profile' organizer.user__id %}">{{ organizer.first_name }} {{ organizer.last_name }}</a>{% if not forloop.last %}, {% endif %}
            {% endfor %}
        </p>

        <p>
            {{ description|safe }}
        </p>

        <!------------------------------- Signups list ------------------------------->
        {% if request.user|is_member and signups.interested or signups.committed or signups.going %}
            <h5>Signups</h5>
            <div id="signup-list">
                {% if signups.going %}
                    <p><b>Going:</b></p>
                    <ul class="list-group">
                        {% for signup in signups.going %}
                            <li class="list-group-item">{{ signup.name }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
                {% if signups.committed %}
                    <p><b>Committed:</b></p>
                    <ul class="list-group">
                        {% for signup in signups.committed %}
                            <li class="list-group-item">{{ signup.name }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
                {% if signups.interested %}
                    <p><b>Interested:</b></p>
                    <ul class="list-group">
                        {% for signup in signups.interested %}
                            <li class="list-group-item">{{ signup.name }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
        {% endif %}

        <hr>

        <!------------------------------- Signup form ------------------------------->
        {% if request.user|is_member and trip.valid_signup_types %}
            <h5>Sign Up</h5>
            <form id="signup-form" method="post">
                {% csrf_token %}
                <div class="mb-4">
                    {{ form.type.label_tag }} {{ form.type }}
                    {% if form.type.errors %}
                        <small>{{ form.type.errors|striptags }}</small>
                    {% endif %}
                </div>

                <div class="mb-4">
                    {{ form.can_drive.label_tag }} {{ form.can_drive }}
                    {% if form.can_drive.errors %}
                        <small>{{ form.can_drive.errors|striptags }}</small>
                    {% endif %}
                </div>

                <div class="mb-4" id="car-spots-div">
                    {{ form.car_spots.label_tag }} {{ form.car_spots }}
                    {% if form.car_spots.errors %}
                        <small>{{ form.car_spots.errors }}</small>
                    {% endif %}
                </div>

                <div class="mb-4">
                    {{ form.signup_answer.label_tag }} <br />
                    {{ form.signup_answer }}
                    {% if form.signup_answer.errors %}
                        <small>{{ form.signup_answer.errors }}</small>
                    {% endif %}
                </div>

                <button type="submit">Submit</button>
            </form>
        {% endif %}
    </div>
    
{% endblock %}
